---
title: "Model evaluations"
author: "Jae Yeon Kim"
output:
html_document: 
  toc: true
  theme: united
---

## 0. Setup 

```{r}

# Clean up the environment

rm(list = ls())

# Import libraries (adapted from this link: https://stackoverflow.com/questions/4090169/elegant-way-to-check-for-missing-packages-and-install-them)

if (!require("pacman")) install.packages("pacman")
pacman::p_load(
        tidyverse, # for the tidyverse framework
        ggpubr, # for arranging ggplot2 
        ggthemes, # for fancy ggplot themes
        broom # for visualizing coefficients
)

source("/home/jae/content-analysis-for-evaluating-ML-performances/functions/theme_publications.r")

theme_set(theme_Publication(14))

source("/home/jae/content-analysis-for-evaluating-ML-performances/functions/text_analysis.r")

```

## 1. Importing files 

```{r include=FALSE}

setwd("/home/jae/content-analysis-for-evaluating-ML-performances/processed_data/")

merged_model50 <- read_csv("/home/jae/content-analysis-for-evaluating-ML-performances/processed_data/merged_model50.csv")

merged_model100 <- read_csv("/home/jae/content-analysis-for-evaluating-ML-performances/processed_data/merged_model100.csv")

```

## 2. Merging them together 

```{r}

merged_model <- bind_rows(mutate(merged_model50, type = "50%"),
                          mutate(merged_model100, type = "100%"))

```

## 3. Visualizing data 

### 3.1. Resampling effect  

```{r}

no_resampling_plot100 <- merged_model %>%
  filter(resampling == "None" & type == "100%") %>%
  visualize_performance() +
  labs(title = "ML performances (without resampling)",
       subtitle = "100%",
       x = "Models", 
       y = "Performance (%)",
       fill = "Metrics") 

no_resampling_plot50 <- merged_model %>%
  filter(resampling == "None" & type == "50%") %>%
  visualize_performance() +
  labs(title = "ML performances (without resampling)",
       subtitle = "50%",
       x = "Models", 
       y = "Performance (%)",
       fill = "Metrics") 

resampling_plot100 <- merged_model %>%
  filter(resampling != "None" & type == "100%") %>%
  visualize_performance() +
  labs(title = "ML performances (resampling)",
       subtitle = "100%",
       x = "Models", 
       y = "Performance (%)",
       fill = "Metrics") 

resampling_plot50 <- merged_model %>%
  filter(resampling != "None" & type == "50%") %>%
  visualize_performance() +
  labs(title = "ML performances (resampling)",
       subtitle = "50%",
       x = "Models", 
       y = "Performance (%)",
       fill = "Metrics") 

ggarrange(no_resampling_plot100, resampling_plot100, 
          no_resampling_plot50, resampling_plot50, common.legend = TRUE)

ggsave("/home/jae/content-analysis-for-evaluating-ML-performances/outputs/ml_performances_comp.png", height = 10, width = 15)

```

```{r}

no_resampling_plot100 <- merged_model %>%
  filter(resampling == "None" & type == "100%") %>%
  visualize_performance() +
  labs(title = "ML performances (without resampling)",
       subtitle = "100%",
       x = "Models", 
       y = "Performance (%)",
       fill = "Metrics") +
       geom_hline(aes(yintercept = content_agreement), linetype = "dashed") 

no_resampling_plot50 <- merged_model %>%
  filter(resampling == "None" & type == "50%") %>%
  visualize_performance() +
  labs(title = "ML performances (without resampling)",
       subtitle = "50%",
       x = "Models", 
       y = "Performance (%)",
       fill = "Metrics") +
       geom_hline(aes(yintercept = content_agreement), linetype = "dashed") 

resampling_plot100 <- merged_model %>%
  filter(resampling != "None" & type == "100%") %>%
  visualize_performance() +
  labs(title = "ML performances (resampling)",
       subtitle = "100%",
       x = "Models", 
       y = "Performance (%)",
       fill = "Metrics") +
       geom_hline(aes(yintercept = content_agreement), linetype = "dashed") 

resampling_plot50 <- merged_model %>%
  filter(resampling != "None" & type == "50%") %>%
  visualize_performance() +
  labs(title = "ML performances (resampling)",
       subtitle = "50%",
       x = "Models", 
       y = "Performance (%)",
       fill = "Metrics") +
       geom_hline(aes(yintercept = content_agreement), linetype = "dashed") 

ggarrange(no_resampling_plot100, resampling_plot100, 
          no_resampling_plot50, resampling_plot50, common.legend = TRUE)

ggsave("/home/jae/content-analysis-for-evaluating-ML-performances/outputs/ml_content_comp.png", height = 10, width = 15)

```

